{% extends 'gl4app/base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}Add a project your company has finished{% endblock %}

{% block title2 %}Add a project your company has finished{% endblock %}

{% block description %}{% endblock %}

{% block head %}
<style>
  .select2-result-stones { display: block; text-align: left; height: 30px; }
  .select2-result-stones .pic { display: inline-block; }
  .select2-result-stones .pic img { width: 200px; height: 30px; border: 0; background: gray; }
  .select2-result-stones .names { display: inline-block; }
  .select2-result-stones .names .name { display: inline; }
  .select2-result-stones .names .pseu { display: inline; color: gray; }
</style>

{% endblock %}

{% block body_classes %}user settings project{% endblock %}



{% block breadcrumb %}
<a href="{% url 'companydb_home' %}">Natural Stone Company Directory</a> &raquo;
<a href="{% url 'companydb_item' user.username %}">{{user.profile.name}}</a> &raquo;
<a href="{% url 'companydb_dashboard' %}">Dashboard</a> &raquo;
<a href="{% url 'companydb_db_projects' %}">Add Project</a> &raquo;
{% endblock %}



{% block main %}

<h1>Add a project</h1>

<form action="" method="POST" class="form-horizontal">{% csrf_token %}
  <div id="div_id_stones" class="form-group">
    <label for="id_stones" class="control-label col-lg-2 requiredField">
      Stones used
    </label>
    <div class="controls col-lg-8">
      <select multiple class="js-select-stones form-control" id="id_stones"></select>
      <p id="hint_id_stones" class="help-block">Start typing the name of a stone used in the project, then select the stones from the list. Add all stones used in the project, but not more than ten.</p>
    </div>
  </div>
</form>

{% endblock %}



{% block foot %}

<script>
$(".js-select-stones").select2({
  ajax: {
    url: "{% url 'stonedb_api_search' %}",
    dataType: 'json',
    delay: 250,
    data: function (params) {
      return { q: params.term, page: params.page };
    },
    processResults: function (data, params) {
      // parse the results into the format expected by Select2
      // since we are using custom formatting functions we do not need to
      // alter the remote JSON data, except to indicate that infinite
      // scrolling can be used
      params.page = params.page || 1;

      return {
        results: data.items,
        pagination: { more: (params.page * 50) < data.total_count },
      };
    },
    cache: true
  },
  escapeMarkup: function (markup) { return markup; }, // let our custom formatter work
  minimumInputLength: 3,
  maximumSelectionLength: 10,
  templateResult: formatResult, // omitted for brevity, see the source of this page
  templateSelection: formatResultSelection // omitted for brevity, see the source of this page
});

function formatResult (item) {
  if (item.loading) return item.text;

  return "<div class='select2-result-stones clearfix'>" +
         "  <div class='pic'><img src='" + item.pic + "'></div>" +
         "  <div class='names'>" +
         "    <div class='name'>" + item.name + "</div> " +
         "    <div class='pseu'>" + item.pseu + "</div>";
         "  </div>" +
         "</div>";
}

function formatResultSelection (item) {
  return item.name
}

</script>

{% endblock %}
